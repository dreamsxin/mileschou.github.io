---
title: JWT 概觀
layout: post
tags:
- ironman
- ironman-11th
- authentication
---

[密碼管理][Day 17]在討論的主要以使用者所輸入的密碼為主，而有另一種類似密碼用途的字串，也用在身分驗證上，正是 token。接下來會來討論最近不少人在使用的 [JWT][]，它是一個開放標準，可以用在需要安全交換資料的場景上。

JWT 相關的 RFC 有下列五個，是由 *JOSE（JSON Object Signing and Encryption）Working Group* 所制定的。

* [RFC 7515 - JSON Web Signature][RFC 7515]（JWS）
* [RFC 7516 - JSON Web Encryption][RFC 7516]（JWE）
* [RFC 7517 - JSON Web Key][RFC 7517]（JWK）
* [RFC 7518 - JSON Web Algorithms][RFC 7518]（JWA）
* [RFC 7519 - JSON Web Token][RFC 7519]（JWT）

其中 JWS 與 JWE 在定義如何做[簽章][Day 11]與[加密][Day 08]，而 JWK 與 JWA 則是在定義演算法與金鑰的保存方法，最後 JWT 則是定義了如何將上述資訊與 claim，結合成一個 token 的樣子。

雖然有 JWE 在定義加密，但實務上的應用大多以 JWS 簽章為主，因為在網路上交換資訊時，確認訊息來源以及資料完整性是很重要的。

適合場景：

1. 授權。在驗證通過後，即可發行 JWT 來進行使用者後續的資源請求
2. 資訊交換。，因它可以保證資訊的來源與完整性，很適合作資訊交換

## 基本概念

一般常見的 JWT 格式，是使用 JWS 簽章的格式。

```
xxx.yyy.zzz
```

結構是一個字串，由兩點 `.` 來分隔出三個區塊，依序代表的內容如下：
                         
* Header
* Payload
* Signature

三個區塊都是 `Base64UrlEncode` 來的。`Base64UrlEncode` 與 `Base64Encode` 稍有不同，簡單來說，`Base64UrlEncode` 比 `Base64Encode` 多做了下面的事：

* `=` 刪光光
* `+` 換成 `-`
* `/` 換成 `_`

### Header

Header 通常會由兩個部分組成：

* 類型（typ），通常就叫 `JWT`
* 演算法（alg），常見的如 `HS256`、`RS256` 等

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

### Payload

Payload 則是存放 claim，代表著實體或使用者相關的資訊。有三種類型：

1.  Registered Claims：預定義的 claim，可加可不加
2.  Public Claims：在 [IANA JSON Web Token Registry](https://www.iana.org/assignments/jwt/jwt.xhtml) 上註冊的名稱，即是 *Public Claims*。
3.  Private Claims：不屬於上述兩個 claim，則是 *Private Claims*。但如果 Public Claims 有，優先使用 Public Claims 的命名會比較好。

比方說：

```json
{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true
}
```

在此例中

* `sub` 是 *Registered Claims*
* `name` 是 *Public Claims*
* `admin` 是 *Private Claims*

### Signature

當有了上述 Header 與 Payload 的資訊後，即可利用 Header 所指定的演算法，與必要的 key 來為此資訊簽章

收到資訊的一方 也就是上述提到的 `aud`，即可驗證此資訊。

## 參考資料

* [JWT][]
* [RFC 7515][]
* [RFC 7516][]
* [RFC 7517][]
* [RFC 7518][]
* [RFC 7519][]

[JWT]: https://jwt.io/
[RFC 7515]: https://tools.ietf.org/html/rfc7515
[RFC 7516]: https://tools.ietf.org/html/rfc7516
[RFC 7517]: https://tools.ietf.org/html/rfc7517
[RFC 7518]: https://tools.ietf.org/html/rfc7518
[RFC 7519]: https://tools.ietf.org/html/rfc7519

[Day 08]: {% post_url ironman/11th/authentication/2019-09-24-day08 %}
[Day 11]: {% post_url ironman/11th/authentication/2019-09-27-day11 %}
[Day 17]: {% post_url ironman/11th/authentication/2019-10-03-day17 %}
